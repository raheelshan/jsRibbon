<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>jsRibbon Demo</title>
  <script src="./jsRibbon-component-state.js"></script>
  <script src="./jsRibbon.js"></script>
  <style>
    body { font-family: system-ui, Arial; padding: 20px; }
    .card { border: 1px solid #ddd; padding: 12px; margin: 8px 0; }
  </style>
</head>
<body>
  <h1>jsRibbon Demo</h1>

  <section>
    <h2>Counter (component)</h2>
    <div data-bind="component:Counter" class="card">
      <div>
        <strong>Count:</strong> <span data-bind="text:count">0</span>
      </div>
      <div style="margin-top:8px">
        <button data-bind="click:inc">+</button>
        <button data-bind="click:dec">-</button>
      </div>
    </div>
  </section>

  <section>
    <h2>Foreach (server-hydrated rows + template)</h2>
    <div data-bind="component:Users" class="card">
      <table border="0" width="100%">
        <thead><tr><th>Name</th><th>Age</th><th></th></tr></thead>
        <tbody data-bind="foreach: [ data: users, as: user ]">
          <!-- server rendered rows (hydrated) -->
          <tr data-key="0">
            <td data-bind="text:user.firstName">Alice</td>
            <td data-bind="text:user.age">30</td>
            <td><button data-bind="click:removeItem">Remove</button></td>
          </tr>
        </tbody>
      </table>
      <div style="margin-top:8px">
        <button data-bind="click:add">Add Random</button>
        <button data-bind="click:show">Console Show</button>
      </div>
    </div>
  </section>

  <section>
    <h2>Dynamic injection demo</h2>
    <div id="dynamic-area" class="card">
      <button id="inject">Inject new Counter markup</button>
    </div>
  </section>

  <script>
    // Counter component
    jsRibbon.component('Counter', ($state) => {
      $state.count = $state.count ?? 0;
      function inc(){ $state.count = ($state.count || 0) + 1; }
      function dec(){ $state.count = Math.max(0, ($state.count || 0) - 1); }
      return { inc, dec };
    });

    // Users with foreach
    jsRibbon.component('Users', ($state) => {
      // If server provided a users array it will already be present; otherwise initialize
      $state.users = $state.users ?? [ { firstName: 'Alice', age: 30 } ];

      function add(){
        $state.users.push({ firstName: 'User' + Math.floor(Math.random()*100), age: 20 + Math.floor(Math.random()*30) });
      }

      function removeItem(ev, dataset, target){
        const row = target.closest('[data-key]');
        if(!row) return;
        const idx = parseInt(row.getAttribute('data-key'), 10);
        if (!isNaN(idx)) $state.users.splice(idx, 1);
      }

      function show(){ console.log('Users state:', JSON.parse(JSON.stringify($state.users || []))); }

      return { add, removeItem, show };
    });

    // Demonstrate dynamic injection â€” MutationObserver will auto-register new markup
    document.getElementById('inject').addEventListener('click', () => {
      const container = document.getElementById('dynamic-area');
      const html = `\n        <div data-bind="component:Counter" class="card">\n          <div>Injected count: <span data-bind="text:count">0</span></div>\n          <div><button data-bind="click:inc">+</button> <button data-bind="click:dec">-</button></div>\n        </div>\n      `;
      container.insertAdjacentHTML('beforeend', html);
    });
  </script>
</body>
</html>
