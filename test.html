<script>
let str = "value: cart.firstName, click : handleClick , class: [ cart.isHidden => hidden, cart.isPink => pink ] , attr: [ cart.titleText => title, cart.placeholderText => placeholder ], foreach: [ data: cart.users, as: user ]";

function splitBindings(input) {
    let result = [];
    let current = '';
    let depth = 0;

    for (let i = 0; i < input.length; i++) {
        let char = input[i];
        if (char === '[') {
            depth++;
            current += char;
        } else if (char === ']') {
            depth--;
            current += char;
        } else if (char === ',' && depth === 0) {
            result.push(current.trim());
            current = '';
        } else {
            current += char;
        }
    }
    if (current.trim()) result.push(current.trim());
    return result;
}

function parseKeyValue(str) {
    let idx = str.indexOf(':');
    if (idx === -1) return [str.trim(), null];
    return [str.slice(0, idx).trim(), str.slice(idx + 1).trim()];
}

function extractBindings(bindings) {
    let refs = [];
    let names = [];

    bindings.forEach(binding => {
        let [key, value] = parseKeyValue(binding);

        if (key === 'value') {
            refs.push(value);
            names.push(key); // "value"
        } 
        else if (key === 'click') {
            // prepend parent context if missing dot
            if (!value.includes('.')) refs.push('cart.' + value);
            else refs.push(value);
            names.push(key); // "click"
        } 
        else if (key === 'class' || key === 'attr') {
            let inner = value.replace(/^\[|\]$/g, '').trim();
            let parts = splitBindings(inner);
            parts.forEach(p => {
                let [from, to] = p.split('=>').map(x => x.trim());
                refs.push(from);
                names.push(to); // take right-hand DOM binding
            });
        }
        else if (key === 'foreach') {
            let inner = value.replace(/^\[|\]$/g, '').trim();
            let parts = splitBindings(inner);
            parts.forEach(p => {
                let [k, v] = parseKeyValue(p);
                if (k === 'data') {
                    refs.push(v);
                    names.push(key); // "foreach"
                }
            });
        }
    });

    return { refs, names };
}

let bindings = splitBindings(str);
let { refs: finalBindings, names: bindingNames } = extractBindings(bindings);

console.log("Final Bindings:", finalBindings);
console.log("Binding Names:", bindingNames);

</script>